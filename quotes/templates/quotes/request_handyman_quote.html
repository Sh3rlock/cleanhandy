{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
    @media (min-width: 992px) {
        
    }

    .cmn-input {
        border-radius: 8px;
        border: 1px solid #F15A29;
        background: var(--white-color);
        padding: 15px 10px !important;
        width: 100%;
        margin-bottom: 15px !important;
    }

    .bg-layer {
        height: 80% !important;
    }

    .common-banner {
        padding: 30px 0 70px !important;
      }

      .service-details {
        padding: 0px 0 !important;
      }

      .leave-comments-form textarea {
        width: 100%;
        height: 150px !important;
      }
      
      .service-list-style {
        padding: 1rem;
        border: 1px solid #F15A29;
        border-radius: 8px;
        margin-bottom: 10px;
      }
      
      /* Responsive tweaks */
      @media (max-width: 768px) {
        .form-row {
          flex-direction: column;
        }
      
        .form-group {
          width: 100%;
        }
      } 

/* Basic reset and style to match input fields */
select {
  -webkit-appearance: none; /* Removes default Safari styling */
  -moz-appearance: none;
  appearance: none;

  background-color: white;
  border: 2px solid #e74c3c; /* Match your input border color */
  border-radius: 8px;         /* Rounded corners like your input */
  padding: 10px;
  font-size: 16px;
  width: 100%;
}

/* Optional: Add a custom dropdown arrow */
.form-style select {
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='5'%3E%3Cpath fill='%23333' d='M0 0l5 5 5-5z'/%3E%3C/svg%3E") !important;
  background-repeat: no-repeat !important;
  background-position: right 10px center !important;
  background-size: 10px 5px !important;
}

/* Optional: Hide native arrow in IE */
select::-ms-expand {
  display: none;
}

.flatpickr-current-month {
  font-size: 130% !important;
}

.list-group-item + .list-group-item {
  border-top-width: 1px !important;
}

.featured-single-info a {
  padding: 8px 35px !important;
}
</style>

<!-- common banner -->
<section class="common-banner">
    <div class="bg-layer" style="background: url({% static '/assets/images/background/common-banner-bg.jpg' %});"></div>
    <div class="common-banner-content">
        <h3>Service Details</h3>
        <div class="breadcrumb">
            <ul>
              <li class="breadcrumb-item active"><a href="{% url 'home' %}">Home</a></li>
              <li class="breadcrumb-item"><i class="fa-solid fa-angles-right"></i> Service Details</li>
            </ul>
        </div>
        {% if user.is_authenticated %}
          <a class="btn-1" href="{% url 'request_cleaning_booking' %}">Book Home Cleaning</a>
        {% else %}
          <a class="btn-1" href="{% url 'cleaning_booking' %}">Book Home Cleaning</a>
        {% endif %}
        {% if user.is_authenticated %}
          <a class="btn-1" href="{% url 'office_cleaning_booking' %}">Book Office Cleaning</a>
        {% else %}
          <a class="btn-1" href="{% url 'office_cleaning_booking' %}">Book Office Cleaning</a>
        {% endif %}
        <!-- {% if user.is_authenticated %}
          <a class="btn-1" href="{% url 'request_handyman_booking' %}">Book Handyman</a>
        {% else %}
          <a class="btn-1" href="{% url 'handyman_booking' %}">Book Handyman</a>
        {% endif %} -->
    </div>
  </section>
  <!-- common banner -->
  
  
  <!-- service details -->
  <section class="service-details">
    <div class="container">
        <div class="common-title">
            <h3>{{ service.name }}</h3>
            <div class="service-details-top-btn">
                <div class="btn-left">
                    <a href="#0">Handyman</a>
                    <a href="#0"><i class="fa-light fa-location-dot"></i> New York, USA</a>
                </div>
                <div class="btn-right d-flex gap-2">
                    
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="service-details-image">
                    <img src="{{ service.service_detail_image.url }}" alt="image"> 
               </div>
               
               <div class="service-details-content">
                <div class="mt-4 mb-4">
                  <button type="button" class="btn-1" onclick="openHandymanQuoteModal()">
                      <i class="fas fa-file-invoice-dollar me-2"></i>Request a Handyman Quote
                  </button>
                </div> 
                   {{ service.description|safe }}
                   <div class="mt-4">
                       <button type="button" class="btn-1" onclick="openHandymanQuoteModal()">
                           <i class="fas fa-file-invoice-dollar me-2"></i>Request a Handyman Quote
                       </button>
                   </div>
               </div>
            </div>
  
            <div class="col-lg-4">
              <div class="service-form-card">
                <h4 class="form-title mb-3">Our Services</h4>
    
                <div class="list-group">
                  <!-- Cleaning Services -->
                  <div style="margin-top: 0.5em; margin-bottom: 0.2em; font-weight: bold; color: #F15A29; font-size: 1.08em; letter-spacing: 0.5px; border-bottom: 1px solid #f3c6b1;">Cleaning Services</div>
                  {% for service in all_services %}
                    {% if service.category.name|lower == 'cleaning' %}
                      <a href="{% url 'request_cleaning_quote' service.id %}" class="service-list-style list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                          <strong>{{ service.name }}</strong><br />
                        </div>
                        <i class="fa-solid fa-arrow-right text-muted"></i>
                      </a>
                    {% endif %}
                  {% endfor %}
                  <!-- Handyman Services -->
                  <div style="margin-top: 1em; margin-bottom: 0.2em; font-weight: bold; color: #F15A29; font-size: 1.08em; letter-spacing: 0.5px; border-bottom: 1px solid #f3c6b1;">Handyman Services</div>
                  {% for service in all_services %}
                    {% if service.category.name|lower == 'handyman' %}
                      <a href="{% url 'request_handyman_quote' service.id %}" class="service-list-style list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                          <strong>{{ service.name }}</strong><br />
                        </div>
                        <i class="fa-solid fa-arrow-right text-muted"></i>
                      </a>
                    {% endif %}
                  {% endfor %}
                  {% if all_services|length == 0 %}
                    <div class="text-muted p-3">No services available.</div>
                  {% endif %}
                </div>
              </div>
    
              <div class="blog-sidebar">
                <div class="sidebar-content" style="margin-top: 3rem; box-shadow: 0 0.25rem 0.75rem rgba(0,0,0,0.05);">
                  
                  <div class="recent-post">
                    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                          <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Popular</button>
                        </li>
                        <li class="nav-item" role="presentation">
                          <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Recent</button>
                        </li>
                        <li class="nav-item" role="presentation">
                          <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Trendy</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_cleaning_2.png' %}" alt="Cleaning Trends 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_1' %}">Top Cleaning Trends in NYC for 2025: What Every Homeowner Should Know</a>
                                </div>
                            </div>
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_handyman_1.png' %}" alt="Handyman Trends 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_2' %}">Handyman Services in NYC: Top Trends to Watch in 2025</a>
                                </div>
                            </div>
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_booking_1.png' %}" alt="Booking Systems 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_3' %}">Booking Systems in 2025: Trends, Simplicity, and Smarter Scheduling</a>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_handyman_1.png' %}" alt="Handyman Trends 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_2' %}">Handyman Services in NYC: Top Trends to Watch in 2025</a>
                                </div>
                            </div>
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_cleaning_2.png' %}" alt="Cleaning Trends 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_1' %}">Top Cleaning Trends in NYC for 2025: What Every Homeowner Should Know</a>
                                </div>
                            </div>
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_booking_1.png' %}" alt="Booking Systems 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_3' %}">Booking Systems in 2025: Trends, Simplicity, and Smarter Scheduling</a>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_booking_1.png' %}" alt="Booking Systems 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_3' %}">Booking Systems in 2025: Trends, Simplicity, and Smarter Scheduling</a>
                                </div>
                            </div>
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_cleaning_2.png' %}" alt="Cleaning Trends 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_1' %}">Top Cleaning Trends in NYC for 2025: What Every Homeowner Should Know</a>
                                </div>
                            </div>
                            <div class="recent-post-list">
                                <div class="recent-post-image">
                                    <img src="{% static 'assets/images/blog/blog_handyman_1.png' %}" alt="Handyman Trends 2025">
                                </div>
                                <div class="recent-post-info">
                                    <a href="{% url 'blog_detail_2' %}">Handyman Services in NYC: Top Trends to Watch in 2025</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                </div>
              </div>
            </div>
        </div>
  </section>
  <!-- service details -->
  
  
  <!-- service 2 -->
  <section class="service-two pt-0" style="background-color: transparent;">
    <div class="container">
        <div class="common-title">
            <h6><i class="fa-solid fa-angles-right"></i> Another Service </h6>
            <h3>Most Related Services</h3>
        </div>
  
        <div class="row">
            
        {% for service in related_services %}
        <div class="col-lg-4 col-md-6">
          <div class="service-tow-single">
              <div class="service-tow-single-img">
                  <img src="{{ service.service_detail_image.url }}" alt="image">
              </div>
              <div class="service-tow-single-content">
                  <a href="{% url 'request_handyman_quote' service.id %}" class="service-tow-single-title">{{ service.name }}</a>
                  <div class="service-tow-single-rating">
                      <p><i class="fa-light fa-location-dot"></i> New York, USA</p>
                  </div>
                  <div class="featured-single-info">
                    <!-- {% if user.is_authenticated %}
                      <a class="btn-1" href="{% url 'request_handyman_booking' %}">Book Now</a>
                    {% else %}
                      <a class="btn-1" href="{% url 'handyman_booking' %}">Book Now</a>
                    {% endif %} -->
                      <div class="featured-single-info-left">
                      </div>
                  </div>
              </div>
          </div>
        </div>
        {% endfor %}
            
        </div>
    </div>
  </section>
  <!-- service 2 -->

<!-- Custom Handyman Quote Modal -->
<div id="handymanQuoteModal" class="simple-modal">
    <div class="simple-modal-content">
        <div class="simple-modal-header">
            <h3>Request Handyman Quote</h3>
            <span class="simple-modal-close" onclick="closeHandymanQuoteModal()">&times;</span>
        </div>
        <div class="simple-modal-body">
            <form id="handymanQuoteForm">
                {% csrf_token %}
                <div class="form-row">
                    <div class="form-group">
                        <label for="id_name">Full Name *</label>
                        <input type="text" id="id_name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="id_email">Email Address *</label>
                        <input type="email" id="id_email" name="email" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="id_phone_number">Phone Number *</label>
                        <input type="tel" id="id_phone_number" name="phone_number" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="id_address">Address *</label>
                    <textarea id="id_address" name="address" rows="3" placeholder="Enter the address where handyman work is needed" required></textarea>
                </div>
                <div class="form-group">
                    <label for="id_job_description">Description about the job *</label>
                    <textarea id="id_job_description" name="job_description" rows="4" placeholder="Please describe the handyman job in detail..." required></textarea>
                </div>
            </form>
        </div>
        <div class="simple-modal-footer">
            <button type="button" class="btn-secondary" onclick="closeHandymanQuoteModal()">Cancel</button>
            <button type="button" class="btn-1" onclick="submitHandymanQuote()">Submit Quote Request</button>
        </div>
    </div>
</div>

<!-- Alert Message -->
<div id="handymanQuoteAlert" class="simple-alert" style="display: none;"></div>

<style>
    .btn-1 {
        padding: 0.5rem 1rem !important; 
    }

    /* Simple Modal Styles */
    .simple-modal {
        display: none;
        position: fixed;
        z-index: 99999999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(3px);
    }

    .simple-modal.show {
        display: block;
    }

    .simple-modal-content {
        background-color: #fff;
        margin: 3% auto;
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 700px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        animation: modalSlideIn 0.3s ease-out;
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .simple-modal-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 1.5rem;
        border-bottom: 3px solid #F15A29;
        border-radius: 12px 12px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .simple-modal-header h3 {
        color: #F15A29;
        font-weight: 700;
        font-size: 1.5rem;
        margin: 0;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .simple-modal-close {
        background: #F15A29;
        color: white;
        font-size: 1.8rem;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 50%;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        font-weight: bold;
    }

    .simple-modal-close:hover {
        background: #d14a1f;
        transform: scale(1.1);
    }

    .simple-modal-body {
        padding: 2rem;
    }

    .simple-modal-footer {
        padding: 1.5rem 2rem;
        border-top: 1px solid #dee2e6;
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        background: #f8f9fa;
        border-radius: 0 0 12px 12px;
    }

    /* Form Styles */
    .form-row {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .form-group {
        flex: 1;
        margin-bottom: 1rem;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s ease;
        background: #fff;
    }

    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #F15A29;
        box-shadow: 0 0 0 3px rgba(241, 90, 41, 0.1);
        transform: translateY(-1px);
    }

    .form-group input.error,
    .form-group textarea.error {
        border-color: #dc3545;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
    }

    .form-group input.error:focus,
    .form-group textarea.error:focus {
        border-color: #dc3545;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
    }

    .form-group textarea {
        resize: vertical;
        min-height: 80px;
    }

    /* Error message styling */
    .error-message {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        font-weight: 500;
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-5px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Button Styles */
    .simple-modal-footer .btn-1 {
        background: #F15A29;
        border: none;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .simple-modal-footer .btn-1:hover {
        background: #d14a1f;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(241, 90, 41, 0.3);
    }

    .simple-modal-footer .btn-secondary {
        background: #6c757d;
        border: none;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .simple-modal-footer .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
    }

    /* Alert Styles */
    .simple-alert {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 99999999;
        min-width: 350px;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        font-weight: 600;
        animation: alertSlideIn 0.4s ease-out;
        border-left: 5px solid;
    }

    @keyframes alertSlideIn {
        from {
            opacity: 0;
            transform: translateX(100%) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateX(0) scale(1);
        }
    }

    .simple-alert.alert-success {
        background: linear-gradient(135deg, #d1e7dd 0%, #c3e6cb 100%);
        color: #0f5132;
        border-left-color: #198754;
    }

    .simple-alert.alert-danger {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border-left-color: #dc3545;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .simple-modal-content {
            width: 95%;
            margin: 2% auto;
            max-height: 95vh;
        }
        
        .simple-modal-header,
        .simple-modal-body,
        .simple-modal-footer {
            padding: 1rem;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .simple-modal-footer {
            flex-direction: column;
        }
        
        .simple-modal-footer .btn-1,
        .simple-modal-footer .btn-secondary {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .simple-alert {
            right: 10px;
            left: 10px;
            min-width: auto;
        }
    }
</style>

<script>
  function openHandymanQuoteModal() {
    document.getElementById("handymanQuoteModal").style.display = "block";
  }

  function closeHandymanQuoteModal() {
    document.getElementById("handymanQuoteModal").style.display = "none";
    // Reset form and clear validation errors
    document.getElementById("handymanQuoteForm").reset();
    clearHandymanValidationErrors();
  }

  function clearHandymanValidationErrors() {
    // Remove all error classes and messages
    const form = document.getElementById('handymanQuoteForm');
    const inputs = form.querySelectorAll('input, textarea');
    
    inputs.forEach(input => {
      input.classList.remove('error');
      const errorDiv = input.parentNode.querySelector('.error-message');
      if (errorDiv) {
        errorDiv.remove();
      }
    });
  }

  function showHandymanFieldError(field, message) {
    // Remove existing error message
    const existingError = field.parentNode.querySelector('.error-message');
    if (existingError) {
      existingError.remove();
    }
    
    // Add error class to field
    field.classList.add('error');
    
    // Create and insert error message
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    errorDiv.style.color = '#dc3545';
    errorDiv.style.fontSize = '0.875rem';
    errorDiv.style.marginTop = '0.25rem';
    
    field.parentNode.appendChild(errorDiv);
  }

  function removeHandymanFieldError(field) {
    field.classList.remove('error');
    const errorDiv = field.parentNode.querySelector('.error-message');
    if (errorDiv) {
      errorDiv.remove();
    }
  }

  function validateHandymanField(field) {
    const value = field.value.trim();
    const fieldName = field.name;
    
    // Remove any existing error
    removeHandymanFieldError(field);
    
    // Required field validation
    if (!value) {
      showHandymanFieldError(field, `${getHandymanFieldLabel(fieldName)} is required`);
      return false;
    }
    
    // Specific field validations
    switch (fieldName) {
      case 'name':
        if (value.length < 2) {
          showHandymanFieldError(field, 'Name must be at least 2 characters long');
          return false;
        }
        if (!/^[a-zA-Z\s]+$/.test(value)) {
          showHandymanFieldError(field, 'Name can only contain letters and spaces');
          return false;
        }
        break;
        
      case 'email':
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
          showHandymanFieldError(field, 'Please enter a valid email address');
          return false;
        }
        break;
        
      case 'phone_number':
        const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
        if (!phoneRegex.test(value.replace(/[\s\-\(\)]/g, ''))) {
          showHandymanFieldError(field, 'Please enter a valid phone number');
          return false;
        }
        break;
        
      case 'address':
        if (value.length < 10) {
          showHandymanFieldError(field, 'Address must be at least 10 characters long');
          return false;
        }
        break;
        
      case 'job_description':
        if (value.length < 20) {
          showHandymanFieldError(field, 'Job description must be at least 20 characters long');
          return false;
        }
        break;
    }
    
    return true;
  }

  function getHandymanFieldLabel(fieldName) {
    const labels = {
      'name': 'Full Name',
      'email': 'Email Address',
      'phone_number': 'Phone Number',
      'address': 'Address',
      'job_description': 'Job Description'
    };
    return labels[fieldName] || fieldName;
  }

  function validateHandymanForm() {
    const form = document.getElementById('handymanQuoteForm');
    const inputs = form.querySelectorAll('input, textarea');
    let isValid = true;
    
    // Validate each field
    inputs.forEach(input => {
      if (!validateHandymanField(input)) {
        isValid = false;
      }
    });
    
    return isValid;
  }

  function submitHandymanQuote() {
    // Clear any existing validation errors
    clearHandymanValidationErrors();
    
    // Validate form before submission
    if (!validateHandymanForm()) {
      showHandymanAlert('danger', 'Please fix the errors in the form before submitting.');
      return;
    }
    
    // Disable submit button to prevent double submission
    const submitBtn = document.querySelector('#handymanQuoteModal .btn-1');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Submitting...';
    
    // Get form data
    const formData = new FormData(document.getElementById('handymanQuoteForm'));
    
    // Submit form via AJAX
    fetch('{% url "handyman_quote_submit" %}', {
      method: 'POST',
      body: formData,
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Show success message
        showHandymanAlert('success', data.message);
        
        // Reset form and close modal
        document.getElementById("handymanQuoteForm").reset();
        closeHandymanQuoteModal();
        
        // Reset submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Submit Quote Request';
      } else {
        // Show error message
        showHandymanAlert('danger', data.message || 'An error occurred. Please try again.');
        
        // Reset submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Submit Quote Request';
      }
    })
    .catch(error => {
      console.error('Error:', error);
      showHandymanAlert('danger', 'An error occurred. Please try again.');
      
      // Reset submit button
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Submit Quote Request';
    });
  }

  function showHandymanAlert(type, message) {
    const alertDiv = document.getElementById('handymanQuoteAlert');
    alertDiv.className = `simple-alert alert-${type}`;
    alertDiv.innerHTML = `
      ${message}
      <button type="button" class="btn-close" onclick="this.parentElement.style.display='none'">&times;</button>
    `;
    alertDiv.style.display = 'block';
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
      alertDiv.style.display = 'none';
    }, 5000);
  }

  // Add real-time validation on input blur
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('handymanQuoteForm');
    const inputs = form.querySelectorAll('input, textarea');
    
    inputs.forEach(input => {
      input.addEventListener('blur', function() {
        validateHandymanField(this);
      });
      
      input.addEventListener('input', function() {
        // Remove error when user starts typing
        if (this.classList.contains('error')) {
          removeHandymanFieldError(this);
        }
      });
    });
  });

  // Close modal when clicking outside it
  window.onclick = function(event) {
    const modal = document.getElementById("handymanQuoteModal");
    if (event.target === modal) {
      closeHandymanQuoteModal();
    }
  }
</script>

{% endblock %}
