{% load quote_filters %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; padding: 20px; }
    h2, h4 { color: #2c3e50; }
    .section { margin-bottom: 30px; }
    .section h4 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    .list-item { margin-left: 20px; }
    .bold { font-weight: bold; }
    .highlight { background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }
  </style>
</head>
<body>
  <h2>üè† Home Cleaning Booking Confirmed!</h2>
  <p>Thank you, {{ booking.name }}! Your home cleaning service has been successfully booked.</p>

  <div class="section">
    <h4>üìã Service Details</h4>
    <div class="highlight">
      {% if booking.square_feet_options %}
        <p><strong>Square Footage:</strong> {{ booking.square_feet_options.name }}</p>
      {% endif %}
      {% if booking.home_types %}
        <p><strong>Home Type:</strong> {{ booking.home_types.name }}</p>
      {% endif %}
      {% if booking.bath_count %}
        <p><strong>Number of Bathrooms:</strong> {{ booking.get_bath_count_display }}</p>
      {% endif %}
      {% if booking.cleaning_type %}
        <p><strong>Cleaning Type:</strong> {{ booking.cleaning_type|clean_cleaning_type }}</p>
      {% endif %}
      {% if booking.extras.all %}
        <p><strong>Selected Extras:</strong></p>
        <ul>
          {% for extra in booking.extras.all %}
            <li>{{ extra.name }} ‚Äî ${{ extra.price }}</li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if booking.recurrence_pattern != "one_time" %}
        <p><strong>Recurring Service:</strong> {{ booking.get_recurrence_pattern_display }}</p>
      {% endif %}
      {% if booking.bath_count %}
        <p><strong>Number of Bathrooms:</strong> {{ booking.get_bath_count_display }}</p>
      {% endif %}
      {% if booking.pet %}
        <p><strong>Pets:</strong> {{ booking.get_pet_display }}</p>
      {% endif %}
      {% if booking.parking %}
        <p><strong>Parking:</strong> {{ booking.parking }}</p>
      {% endif %}
      {% if booking.get_in %}
        <p><strong>How we'll get in:</strong> {{ booking.get_get_in_display }}</p>
      {% endif %}
    </div>
  </div>

  <div class="section">
    <h4>üìÖ Schedule Information</h4>
    <div class="highlight">
      <p><strong>Date:</strong> {{ booking.date|date:"F j, Y" }}</p>
      <p><strong>Time:</strong> {{ booking.hour|time:"g:i A" }}</p>
      <p><strong>Duration:</strong> {{ booking.hours_requested }} hour{{ booking.hours_requested|pluralize }}</p>
      {% if booking.num_cleaners %}
        <p><strong>Number of Cleaners:</strong> {{ booking.num_cleaners }}</p>
      {% endif %}
      <p><strong>Service Type:</strong> 
        {% if booking.recurrence_pattern != "one_time" %}
          {{ booking.get_recurrence_pattern_display }}
        {% else %}
          One-time
        {% endif %}
      </p>
    </div>
  </div>

  <div class="section">
    <h4>üìç Service Location</h4>
    <div class="highlight">
      <p><strong>Address:</strong> {{ booking.address }}{% if booking.apartment %}, Apt {{ booking.apartment }}{% endif %}</p>
      <p><strong>City:</strong> {{ booking.city|default:"New York" }}</p>
      <p><strong>State:</strong> {{ booking.state|default:"NY" }}</p>
      <p><strong>ZIP Code:</strong> {{ booking.zip_code }}</p>
      {% if booking.parking %}
        <p><strong>Parking:</strong> {{ booking.parking }}</p>
      {% endif %}
      {% if booking.get_in %}
        <p><strong>How we'll get in:</strong> {{ booking.get_get_in_display }}</p>
      {% endif %}
      {% if booking.pet %}
        <p><strong>Pets:</strong> {{ booking.get_pet_display }}</p>
      {% endif %}
    </div>
  </div>

  <div class="section">
    <h4>üí∞ Price Breakdown</h4>
    <div class="highlight">
      {% if booking.square_feet_options %}
        <p class="list-item">Square Footage ({{ booking.square_feet_options.name }}): ${{ booking.square_feet_options.price }}</p>
      {% endif %}
      {% if not booking.is_large_home and booking.home_types %}
        <p class="list-item">Home Type ({{ booking.home_types.name }}): ${{ booking.home_types.price }}</p>
      {% endif %}
      {% if booking.extras.all %}
        <p class="list-item">Extras:</p>
        {% for extra in booking.extras.all %}
          <p class="list-item">+ {{ extra.name }}: ${{ extra.price }}</p>
        {% endfor %}
      {% endif %}
      {% if booking.is_large_home and booking.num_cleaners and booking.hours_requested %}
        <p class="list-item">Labor Cost: ${{ booking.num_cleaners }} √ó {{ booking.hours_requested }} hour{{ booking.hours_requested|pluralize }} √ó 
          {% if booking.cleaning_type and "post" in booking.cleaning_type|lower or "renovation" in booking.cleaning_type|lower %}$63{% else %}$58{% endif %}/hour = 
          ${{ booking.calculate_subtotal|floatformat:2 }}
        </p>
      {% endif %}
      
      <!-- Frequency Discount for Home Cleaning -->
      {% if booking.cleaning_frequency and booking.cleaning_frequency != "one_time" %}
        <p class="list-item" style="color: #28a745; font-weight: bold;">Frequency Discount ({{ booking.get_cleaning_frequency_display }}): -${{ booking.calculate_frequency_discount_amount|floatformat:2 }}</p>
      {% endif %}
      
      <p class="list-item">Subtotal: 
        {% if booking.cleaning_frequency and booking.cleaning_frequency != "one_time" %}
          ${{ booking.calculate_subtotal|sub:booking.calculate_frequency_discount_amount|floatformat:2 }}
        {% else %}
          ${{ booking.calculate_subtotal|floatformat:2 }}
        {% endif %}
      </p>
      <p class="list-item">Sales Tax (8.875%): 
        {% if booking.cleaning_frequency and booking.cleaning_frequency != "one_time" %}
          ${{ booking.calculate_subtotal|sub:booking.calculate_frequency_discount_amount|mul:0.08875|floatformat:2 }}
        {% else %}
          ${{ booking.calculate_tax|floatformat:2 }}
        {% endif %}
      </p>
      {% if booking.gift_card_discount > 0 %}
        <p class="list-item">Gift Card/Discount: -${{ booking.gift_card_discount|floatformat:2 }}</p>
      {% endif %}
      <p class="list-item bold">Total: ${{ booking.price|floatformat:2 }}</p>
    </div>
  </div>

  {% if booking.get_paid_amount > 0 %}
  <div class="section">
    <h4>üí≥ Payment Summary</h4>
    <div class="highlight" style="background-color: #e8f5e8; border-left: 4px solid #28a745;">
      <p><strong>Type:</strong> {{ booking.get_payment_type_for_display }}</p>
      <p><strong>Paid:</strong> ‚Ç¨{{ booking.get_paid_amount|floatformat:2 }}</p>
      {% if booking.get_paid_amount < booking.price %}
        <p><strong>Remaining:</strong> ‚Ç¨{{ booking.price|sub:booking.get_paid_amount|floatformat:2 }}</p>
      {% else %}
        <p><strong>Status:</strong> <span style="color: #28a745; font-weight: bold;">Fully Paid</span></p>
      {% endif %}
    </div>
  </div>
  {% endif %}

  {% if booking.job_description %}
  <div class="section">
    <h4>üìù Special Instructions</h4>
    <div class="highlight">
      <p>{{ booking.job_description }}</p>
    </div>
  </div>
  {% endif %}

  <div class="section">
    <h4>üìû Contact Information</h4>
    <div class="highlight">
      <p><strong>Name:</strong> {{ booking.name }}</p>
      <p><strong>Email:</strong> {{ booking.email }}</p>
      <p><strong>Phone:</strong> {{ booking.phone }}</p>
    </div>
  </div>

  <div class="section">
    <h4>‚ÑπÔ∏è Important Notes</h4>
    <ul>
      <li>Please ensure access to your home at the scheduled time</li>
      <li>Our team will arrive with all necessary cleaning supplies and equipment</li>
      <li>If you need to reschedule, please contact us at least 24 hours in advance</li>
      <li>Payment is due upon completion of service</li>
      {% if booking.parking %}
      <li><strong>Parking:</strong> {{ booking.parking }}</li>
      {% endif %}
      {% if booking.pet %}
      <li><strong>Pets:</strong> {{ booking.get_pet_display }}</li>
      {% endif %}
      {% if booking.get_in %}
      <li><strong>Access:</strong> {{ booking.get_get_in_display }}</li>
      {% endif %}
    </ul>
  </div>

  <p>Thank you for choosing CleanHandy for your home cleaning needs!</p>
  <p>If you have any questions, please don't hesitate to contact us.</p>

  <hr>
  <p><small>This is an automated confirmation email. Please do not reply to this message.</small></p>
</body>
</html>
